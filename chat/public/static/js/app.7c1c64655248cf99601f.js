webpackJsonp([1],{0:function(e,t){},"F/jX":function(e,t){},HTCa:function(e,t){},NHnr:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s("mvHQ"),i=s.n(n),o=s("//Fk"),a=s.n(o),r=s("7+uW"),c=s("NYxO"),u={name:"SideBar",components:{"server-cont":{template:'<div class="server-cont"><div class="server"></div><slot name="server-name">%server-name%</slot><slot name="members-count">%members-count%</slot><slot name="notifications-count">%notifications-count%</slot><div class="clearfix"></div></div>'}},computed:{servers:function(){return this.$store.getters.getServers},showMenu:function(){return this.$store.getters.getShowMenu}},methods:{toggleMenu:function(){this.$store.dispatch("toggleMenu",!0)},fetchServers:function(){this.$store.dispatch("fetchServers")},openChat:function(e){this.$store.dispatch("openChat",e)}}},l={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("transition",{attrs:{name:"sidebarSlide"}},[s("div",{class:{open:e.showMenu},attrs:{id:"sidebar"}},[s("div",{staticClass:"logo-cont",on:{click:e.toggleMenu}}),e._v(" "),e._l(e.servers,function(t){return s("server-cont",{key:t._id,nativeOn:{click:function(s){e.openChat(t._id)}}},[s("div",{directives:[{name:"show",rawName:"v-show",value:e.showMenu,expression:"showMenu"}],staticClass:"server-name",attrs:{slot:"server-name"},slot:"server-name"},[s("i",{staticClass:"material-icons",staticStyle:{padding:"1px 4px 1px 0px",float:"left"}},[e._v("group")]),e._v("\n        "+e._s(t.name)+"\n      ")]),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:e.showMenu,expression:"showMenu"}],staticClass:"server-users",attrs:{slot:"members-count"},slot:"members-count"},[e._v("\n        "+e._s(t.members.length)+" people\n      ")]),e._v(" "),s("span",{attrs:{slot:"notifications-count"},slot:"notifications-count"},[t.notifications?s("div",{staticClass:"notifications"},[e._v("\n          "+e._s(t.notifications)+"\n        ")]):e._e()])])}),e._v(" "),s("div",{staticClass:"addNew-btn",on:{click:e.fetchServers}},[s("i",{staticClass:"material-icons"},[e._v("add")])])],2)])},staticRenderFns:[]};var d=s("VU/8")(u,l,!1,function(e){s("F/jX")},null,null).exports,g={name:"CuFooter",data:function(){return{msgText:""}},computed:{userOptions:function(){return this.$store.getters.getShowUserOptions},showMenu:function(){return this.$store.getters.getShowMenu},showProfile:function(){return this.$store.getters.getShowProfile},userDetails:function(){return this.$store.getters.getUserDetails},preLoad:function(){return this.$store.getters.getPreLoad}},methods:{toggleUserOptions:function(){this.$store.dispatch("toggleUserOptions")},logout:function(){this.$store.dispatch("doLogout")},sendMessage:function(){var e={msgType:"message",text:"",conversationID:this.$store.getters.getOpenedChat};this.msgText&&(e.text=this.msgText,this.msgText="",console.log(this.$refs),this.$refs.msg.focus(),this.msgText.match(/:img:$/g)&&(this.msgText=this.msgText.match(/.+(?=:.*:)/g)[0],e.msgType="image"),this.$store.dispatch("sendMessage",e))}}},h={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("transition",{attrs:{name:"slideUp"}},[e.showMenu||e.showProfile||e.preLoad?e._e():s("div",{staticClass:"cu-footer",class:{open:e.userOptions}},[s("div",{staticClass:"profile-ico-container"},[s("div",{staticClass:"profile-ico",on:{click:e.toggleUserOptions}},[s("img",{attrs:{src:e.userDetails.picture}})])]),e._v(" "),s("div",{staticClass:"inp-section"},[s("div",{staticClass:"msg-input"},[s("div",{staticClass:"status"}),e._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.msgText,expression:"msgText"}],ref:"msg",attrs:{type:"text",placeholder:"Write a message..."},domProps:{value:e.msgText},on:{keyup:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?e.sendMessage(t):null},input:function(t){t.target.composing||(e.msgText=t.target.value)}}}),e._v(" "),s("button",{staticClass:"send-btn",attrs:{type:"button"},on:{click:e.sendMessage}},[s("i",{staticClass:"material-icons"},[e._v("send")])]),e._v(" "),s("i",{staticClass:"material-icons"},[e._v("keyboard_voice")]),e._v(" "),s("i",{staticClass:"material-icons"},[e._v("add_a_photo")]),e._v(" "),s("i",{staticClass:"material-icons"},[e._v("attachment")]),e._v(" "),s("div",{staticClass:"user-options"},[s("div",{staticClass:"logout",on:{click:e.logout}},[s("i",{staticClass:"material-icons"},[e._v("exit_to_app")]),e._v(" "),s("div",{staticClass:"label"},[e._v("Signout")])]),e._v(" "),s("div",{staticClass:"settings"},[s("i",{staticClass:"material-icons"},[e._v("settings")]),e._v(" "),s("div",{staticClass:"label"},[e._v("Settings")])]),e._v(" "),s("div",{staticClass:"change-status"},[s("div",{staticClass:"label"},[e._v("Away")])])])])])])])},staticRenderFns:[]};var f=s("VU/8")(g,h,!1,function(e){s("XW58")},null,null).exports,m=s("rdLu"),p={name:"ChatSection",computed:{selectedMsgsCount:function(){return this.$store.state.selectedMsgsCount},msgs:function(){return this.$store.getters.getMsgs},showMenu:function(){return this.$store.getters.getShowMenu},userDetails:function(){return this.$store.getters.getUserDetails},users:function(){return this.$store.getters.getUsers},preLoad:function(){return this.$store.getters.getPreLoad},hideChat:function(){return this.$store.getters.getHideChat}},methods:{toggleSelectMsg:function(e){this.$store.dispatch("toggleSelectMsg",e)},deselectAllMsgs:function(){this.$store.dispatch("deselectAllMsgs")},userChange:function(e,t){if(e<1)return!1;for(var s,n=m.findWhere(this.msgs,{conversationID:t,queueNumber:e}),i=1;void 0==s;)s=m.findWhere(this.msgs,{conversationID:t,queueNumber:e-i}),i+=1;return n.from!=s.from},getUsername:function(e){var t;return void 0!=(t=m.findWhere(this.users,{_id:e}))?t.name:e},getUserImage:function(e){var t;return void 0!=(t=m.findWhere(this.users,{_id:e}))?t.picture:e}}},v={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.showMenu||e.preLoad?e._e():s("div",{staticClass:"chat-section"},[s("transition",{attrs:{name:"prop-slide"}},[e.selectedMsgsCount?s("div",{staticClass:"msg-prop"},[s("div",{staticClass:"close-btn",on:{click:e.deselectAllMsgs}},[s("i",{staticClass:"material-icons"},[e._v("close")])]),e._v(" "),s("div",{staticClass:"elem",staticStyle:{width:"140px"}},[s("div",{staticClass:"label"},[e._v("\n          selected messages "+e._s(e.selectedMsgsCount)+"\n          "),s("span",{staticStyle:{"font-size":"14px",padding:"0px 3px","font-weight":"700"}})])]),e._v(" "),s("div",{staticClass:"elem"},[s("i",{staticClass:"material-icons"},[e._v("edit")]),e._v(" "),s("div",{staticClass:"label"},[e._v("Edit")])]),e._v(" "),s("div",{staticClass:"elem"},[s("i",{staticClass:"material-icons"},[e._v("delete")]),e._v(" "),s("div",{staticClass:"label"},[e._v("Delete")])]),e._v(" "),s("div",{staticClass:"elem"},[s("i",{staticClass:"material-icons"},[e._v("forward")]),e._v(" "),s("div",{staticClass:"label"},[e._v("Forward")])]),e._v(" "),s("div",{staticClass:"elem"},[s("i",{staticClass:"material-icons"},[e._v("content_copy")]),e._v(" "),s("div",{staticClass:"label"},[e._v("Copy")])])]):e._e()]),e._v(" "),s("div",{staticClass:"chat-cont",class:{open:e.selectedMsgsCount}},[s("transition",{attrs:{name:"chatFade",mode:"out-in"}},[s("div",{staticClass:"chat"},[s("transition-group",{attrs:{name:"",mode:"out-in"}},e._l(e.msgs,function(t){return s("div",{key:t._id,staticClass:"msg-cont",class:{mine:t.from==e.userDetails._id}},["notification"==t.msgType?s("div",{staticClass:"notification"},[e._v("\n              "+e._s(t.text)+"\n            ")]):e._e(),e._v(" "),e.userChange(t.queueNumber,t.conversationID)&&"notification"!=t.msgType?s("div",{staticClass:"user-change"},[e._v("\n              "+e._s(e.getUsername(t.from))+"\n            ")]):e._e(),e._v(" "),e.userChange(t.queueNumber,t.conversationID)&&t.from!=e.userDetails._id&&"notification"!=t.msgType?s("div",{staticClass:"user-img"},[s("img",{attrs:{src:e.getUserImage(t.from)}})]):e._e(),e._v(" "),"notification"!=t.msgType?s("div",{staticClass:"user-msg",class:{selected:t.selected,image:"image"==t.msgType},on:{click:function(s){e.toggleSelectMsg(t._id)}}},[s("div",{staticClass:"time"},[e._v(e._s(t.date.match(/\d\d:.+(?=\:)/g)[0]))]),e._v(" "),s("div",{staticClass:"text"},[e._v(e._s(t.text))]),e._v(" "),"image"==t.msgType?s("img",{attrs:{src:t.text}}):e._e()]):e._e()])})),e._v(" "),s("div",{staticClass:"extra-padding"})],1)])],1)],1)},staticRenderFns:[]};var _=s("VU/8")(p,v,!1,function(e){s("smEg")},null,null).exports,C={name:"MemberList",components:{"user-cont":{template:'<div class="user"><div class="user-image"><slot name="user-picture">%user-picture%</slot></div><span style="float:left;width:130px;"><div class="user-name"><slot name="display-name">%display-name%</slot></div><div class="user-status"><slot name="user-status">%user-status%</slot></div></span></div>'}},computed:{showMenu:function(){return this.$store.getters.getShowMenu},users:function(){return this.$store.getters.getUsers},showProfile:function(){return this.$store.getters.getShowProfile},openedChat:function(){return this.$store.getters.getOpenedChat},chatMembers:function(){return this.$store.getters.getMembersObj},onlineMembers:function(){return this.$store.getters.getOnlineMembers},offlineMembers:function(){return this.$store.getters.getOfflineMembers},preLoad:function(){return this.$store.getters.getPreLoad}},methods:{toggleShowProfile:function(){this.$store.dispatch("toggleShowProfile")}}},S={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("transition",{attrs:{name:"memberListSlide"}},[e.showMenu||e.preLoad?e._e():s("div",{staticClass:"member-list",class:{open:e.showProfile}},[e.showProfile?e._e():s("div",{staticClass:"online"},[s("div",{staticClass:"header"},[e._v("online-"+e._s(e.onlineMembers.length))]),e._v(" "),s("transition-group",{attrs:{name:"fade"}},e._l(e.onlineMembers,function(t){return s("user-cont",{key:t._id,nativeOn:{click:function(t){return e.toggleShowProfile(t)}}},[s("span",{attrs:{slot:"user-picture"},slot:"user-picture"},[s("img",{attrs:{src:t.picture}})]),e._v(" "),s("span",{attrs:{slot:"display-name"},slot:"display-name"},[e._v(e._s(t.name))]),e._v(" "),s("span",{attrs:{slot:"user-status"},slot:"user-status"},[e._v(e._s(t.online?"online":"offline"))])])}))],1),e._v(" "),e.showProfile?e._e():s("div",{staticClass:"offline"},[s("div",{staticClass:"header"},[e._v("offline-"+e._s(e.offlineMembers.length))]),e._v(" "),s("transition-group",{attrs:{name:"fade"}},e._l(e.offlineMembers,function(t){return s("user-cont",{key:t._id,nativeOn:{click:function(t){return e.toggleShowProfile(t)}}},[s("span",{attrs:{slot:"user-picture"},slot:"user-picture"},[s("img",{attrs:{src:t.picture}})]),e._v(" "),s("span",{attrs:{slot:"display-name"},slot:"display-name"},[e._v(e._s(t.name))]),e._v(" "),s("span",{attrs:{slot:"user-status"},slot:"user-status"},[e._v(e._s(t.online?"online":"offline"))])])}))],1),e._v(" "),s("transition",{attrs:{name:"fade"}},[e.showProfile?s("div",{staticClass:"profile"},[s("div",{staticClass:"pf-container"},[s("div",{staticClass:"user-image"},[s("img")]),e._v(" "),s("div",{staticClass:"close-btn",on:{click:e.toggleShowProfile}},[s("i",{staticClass:"material-icons"},[e._v("keyboard_arrow_right")])])])]):e._e()])],1)])},staticRenderFns:[]};var w=s("VU/8")(C,S,!1,function(e){s("HTCa")},null,null).exports,b={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("transition",{attrs:{name:"fade"}},[e.preLoad?s("div",{staticClass:"pre-loader-cont",on:{keyup:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?e.enterApp(t):null}}},[s("div",{staticClass:"enter-btn",on:{click:e.enterApp}},[e._v("\n      Enter\n    ")]),e._v(" "),e.authenticated?s("div",{staticClass:"logout-btn",on:{click:e.logout}},[e._v("\n      Logout\n    ")]):e._e()]):e._e()])},staticRenderFns:[]};var E=s("VU/8")({name:"PreLoad",props:["auth","authenticated"],computed:{preLoad:function(){return this.$store.getters.getPreLoad}},methods:{logout:function(){this.$store.dispatch("doLogout")},enterApp:function(){var e=this;this.authenticated?this.$store.dispatch("checkAuth").then(function(){e.$store.dispatch("togglePreLoad",!1)}):this.$store.dispatch("doLogin")}}},b,!1,function(e){s("s6+O")},null,null).exports,M=s("Zrlr"),T=s.n(M),k=s("wxAW"),L=s.n(k),O=s("2fyi"),y=s.n(O),D={clientId:"xLdhXhO_gp2bCFQ0B5cJTcqJqqpq_hBI",domain:"chat-demo-app.eu.auth0.com",callbackUrl:"http://localhost:8080/callback",apiUrl:"http://localhost:3000/api"},U=s("BzvE"),x=s.n(U),I=s("/ocq"),$={render:function(){var e=this.$createElement;return(this._self._c||e)("div",{staticClass:"spinner"})},staticRenderFns:[]};var P=s("VU/8")({name:"Callback",props:["auth"],data:function(){return this.auth.handleAuthentication(),{}}},$,!1,function(e){s("U+iG")},null,null).exports;r.a.use(I.a);var G=new I.a({mode:"history",routes:[{path:"/callback",name:"Callback",component:P}]}),j=function(){function e(){T()(this,e),this.authenticated=this.isAuthenticated(),this.authNotifier=new x.a,this.auth0=new y.a.WebAuth({domain:D.domain,clientID:D.clientId,redirectUri:D.callbackUrl,audience:D.apiUrl,responseType:"token id_token",scope:"openid profile email"}),this.login=this.login.bind(this),this.setSession=this.setSession.bind(this),this.logout=this.logout.bind(this),this.isAuthenticated=this.isAuthenticated.bind(this)}return L()(e,[{key:"login",value:function(){this.auth0.authorize()}},{key:"handleAuthentication",value:function(){var e=this;this.auth0.parseHash(function(t,s){s&&s.accessToken&&s.idToken?(e.setSession(s),G.replace("/")):t&&(G.replace("/"),console.log(t),alert("Error: "+t.error+". Check the console for further details."))})}},{key:"setSession",value:function(e){var t=i()(1e3*e.expiresIn+(new Date).getTime());localStorage.setItem("access_token",e.accessToken),localStorage.setItem("id_token",e.idToken),localStorage.setItem("expires_at",t),this.authNotifier.emit("authChange",{authenticated:!0})}},{key:"logout",value:function(){localStorage.removeItem("access_token"),localStorage.removeItem("id_token"),localStorage.removeItem("expires_at"),this.userProfile=null,this.authNotifier.emit("authChange",{authenticated:!1}),G.go(G.currentRoute)}},{key:"isAuthenticated",value:function(){var e=JSON.parse(localStorage.getItem("expires_at"));return(new Date).getTime()<e}}]),e}(),A=new j,H=A.login,N=A.logout,q=A.authenticated,R=A.authNotifier,F={name:"App",components:{"side-bar":d,"cu-footer":f,"chat-section":_,"member-list":w,"pre-load":E},data:function(){var e=this;return R.on("authChange",function(t){e.authenticated=t.authenticated,console.log(t),e.$store.dispatch("checkAuth")}),{auth:A,authenticated:q}},computed:{count:function(){return this.$store.state.selectedMsgsCount}},methods:{login:H,logout:N}},W={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"app"}},[s("pre-load",{attrs:{auth:e.auth,authenticated:e.authenticated}}),e._v(" "),s("router-view",{attrs:{auth:e.auth,authenticated:e.authenticated}}),e._v(" "),s("side-bar"),e._v(" "),s("div",{attrs:{id:"main-container"}},[s("chat-section"),e._v(" "),s("member-list"),e._v(" "),s("cu-footer")],1)],1)},staticRenderFns:[]};var B=s("VU/8")(F,W,!1,function(e){s("hJ0K")},null,null).exports,V=s("mtWM"),J=s.n(V),Z=s("DmT9"),z=s.n(Z),X=s("mw3O"),K=s.n(X),Q=s("CoJ8"),Y=s.n(Q),ee=z.a.connect("http://localhost:3000",{query:"token="+localStorage.getItem("access_token")}),te=new j,se=te.login,ne=te.logout,ie="http://localhost:3000/";r.a.use(Y.a),r.a.use(c.a),r.a.config.productionTip=!1;var oe=new c.a.Store({state:{preLoad:!0,showMenu:!1,selectedMsgsCount:0,showUserOptions:!1,showProfile:!1,openedChat:"",hideChat:!0,servers:[{members:[],_id:"5aa28c735bbed02703410dc8",name:"chat1",notifications:4},{members:[],_id:"5aa28c735bbed02703410dc9",name:"chat2",notifications:1}],msgs:[{_id:"5aa28csdf735bb",msgType:"notification",conversationID:"fijoiajfoiahfoafjpafk",date:"2018-03-11T08:44:18.716Z",text:"chat created",queueNumber:0,selected:!1},{_id:"5aa28c735bb",msgType:"message",from:"fasdrtwekrjieoewjroiqq",conversationID:"fijoiajfoiahfoafjpafk",date:"2018-03-11T08:44:18.716Z",text:"lorem ipsum",queueNumber:1,selected:!1},{_id:"5aa28c73234235bb",msgType:"message",from:"fasdrtwekrjieoewjroiqq",conversationID:"fijoiajfoiahfoafjpafk",date:"2018-03-11T08:44:18.716Z",text:"lorem ipsum",queueNumber:2,selected:!1},{_id:"5aa28c7werwe35bb",msgType:"message",from:"fasdrtwekrjieoewjroiqq",conversationID:"fijoiajfoiahfoafjpafk",date:"2018-03-11T08:44:18.716Z",text:"lorem ipsum",queueNumber:3,selected:!1},{_id:"5aa28c7sdf354b",msgType:"message",from:"sejkfhu3y78rtq87r782",conversationID:"fijoiajfoiahfoafjpafk",date:"2018-03-11T08:44:18.716Z",text:"lorem ipsum",queueNumber:4,selected:!1},{_id:"5aa28c7wewrerwe35bb",msgType:"message",from:"fasdrtwekrjieoewjroiqq",conversationID:"fijoiajfoiahfoafjpafk",date:"2018-03-11T08:44:18.716Z",text:"lorem ipsum",queueNumber:5,selected:!1}],usersData:[{_id:"sejkfhu3y78rtq87r782",name:"user1",online:!1,picture:"test.png"},{_id:"fasdrtwekrjieoewjroiqq",name:"user2",online:!1,picture:"test.png"}],userDetails:{_id:"sejkfhu3y78rtq87r782",name:"user1",picture:"test.png"}},getters:{getServers:function(e){return e.servers},getMsgs:function(e){return e.msgs},getUsers:function(e){return e.usersData},getShowMenu:function(e){return e.showMenu},getSelectedMsgsCount:function(e){return e.selectedMsgsCount},getShowUserOptions:function(e){return e.showUserOptions},getShowProfile:function(e){return e.showProfile},getUserDetails:function(e){return e.userDetails},getOpenedChat:function(e){return e.openedChat},getServerByID:function(e){return function(t){return e.servers.find(function(e){return e._id===t})}},getServerMembers:function(e,t){return t.getServerByID(e.openedChat).members},getUserByID:function(e){return function(t){return e.usersData.find(function(e){return e._id===t})}},getMembersObj:function(e,t){var s=[];return t.getServerByID(e.openedChat).members.forEach(function(e){s.push(t.getUserByID(e))}),s},getOnlineMembers:function(e,t){return t.getMembersObj.filter(function(e){return e.online})},getOfflineMembers:function(e,t){return t.getMembersObj.filter(function(e){return!e.online})},getHeaders:function(){if(localStorage.getItem("access_token"))return{headers:{Authorization:"Bearer "+localStorage.getItem("access_token")}};oe.dispatch("doLogin")},getPreLoad:function(e){return e.preLoad},getHideChat:function(e){return e.hideChat}},mutations:{ADD_TODO:function(e,t){var s={id:t.newId,task:t.task,completed:!1};e.todos.unshift(s)},TOGGLE_MENU:function(e,t){e.showMenu=!!t},TOGGLE_PRELOAD:function(e,t){e.preLoad=!!t},TOGGLE_USER_OPTIONS:function(e){e.showUserOptions=!e.showUserOptions},TOGGLE_SHOW_PROFILE:function(e){e.showProfile=!e.showProfile},HIDE_PROFILE:function(e,t){e.showProfile=!t},TOGGLE_SELECT_MSG:function(e,t){var s=e.msgs.find(function(e){return e._id===t});s.selected=!s.selected,s.selected?e.selectedMsgsCount++:e.selectedMsgsCount--},DESELECT_ALL_MSGS:function(e){e.msgs.forEach(function(e){return e.selected=!1}),e.selectedMsgsCount=0},FETCH_SERVERS:function(e,t){e.servers=t},GET_USER:function(e,t){e.userDetails._id=t._id,e.userDetails.name=t.name,e.userDetails.picture=t.picture},SET_OPENED_CHAT:function(e,t){e.openedChat=t},FETCH_MSGS:function(e,t){e.msgs=t},FETCH_USERS:function(e,t){e.usersData=t},TOGGLE_HIDE_CHAT:function(e,t){e.hideChat=t}},actions:{toggleMenu:function(e,t){e.commit("DESELECT_ALL_MSGS"),e.commit("TOGGLE_MENU",t)},toggleLoggedIn:function(e,t){e.commit("TOGGLE_LOGGEDIN",t)},toggleHideChat:function(e,t){e.commit("TOGGLE_HIDE_CHAT",t)},togglePreLoad:function(e,t){e.commit("TOGGLE_MENU",!t),e.commit("TOGGLE_PRELOAD",t)},toggleUserOptions:function(e){e.commit("TOGGLE_USER_OPTIONS")},toggleShowProfile:function(e){e.commit("DESELECT_ALL_MSGS"),e.commit("TOGGLE_SHOW_PROFILE")},hideProfile:function(e,t){e.commit("DESELECT_ALL_MSGS"),e.commit("HIDE_PROFILE",t)},toggleSelectMsg:function(e,t){e.commit("TOGGLE_SELECT_MSG",t)},deselectAllMsgs:function(e){e.commit("DESELECT_ALL_MSGS")},fetchServers:function(e){return new a.a(function(t,s){console.log(ie+"api/convs"),J.a.get(ie+"api/convs",oe.getters.getHeaders).then(function(n){"done"==n.data.message?(e.commit("FETCH_SERVERS",n.data.data),t()):s("error")}).catch(function(e){s(e)})})},getUser:function(e){return new a.a(function(t,s){console.log(ie+"api/user"),J.a.get(ie+"api/user",oe.getters.getHeaders).then(function(n){"done"==n.data.message?(n.data.data.picture=decodeURIComponent(n.data.data.picture.replace(/^https.*?(?=https)/gi,"")),n.data.data.picture=decodeURIComponent(n.data.data.picture.replace(/lh4\.google/,"lh3.google")),e.commit("GET_USER",n.data.data),t()):s("error")}).catch(function(e){s(e)})})},openChat:function(e,t){var s=this;t!=oe.getters.getOpenedChat&&(oe.dispatch("toggleHideChat",!0),oe.getters.getServers.find(function(e){return e._id===t}).notifications=0,e.commit("SET_OPENED_CHAT",t),oe.dispatch("fetchMsgs",t).then(function(){oe.dispatch("fetchUsers").then(function(){setTimeout(function(){s.dispatch("toggleHideChat",!1),s.dispatch("toggleMenu",!1)},300)},function(e){console.log(e)})},function(e){console.log(e)}))},fetchMsgs:function(e,t){return new a.a(function(s,n){console.log(ie+"api/msgs/"),J.a.get(ie+"api/msgs/"+t,oe.getters.getHeaders).then(function(t){"done"==t.data.message?(e.commit("FETCH_MSGS",t.data.data),s()):n("error")}).catch(function(e){n(e)})})},fetchUsers:function(e){return new a.a(function(t,s){console.log(ie+"api/users"),J.a.get(ie+"api/users",oe.getters.getHeaders).then(function(n){"done"==n.data.message?(n.data.data.forEach(function(e){e.picture=decodeURIComponent(e.picture.replace(/^https.*?(?=https)/gi,"")),e.picture=decodeURIComponent(e.picture.replace(/lh4\.google/,"lh3.google"))}),e.commit("FETCH_USERS",n.data.data),t()):s("error")}).catch(function(e){s(e)})})},sendMessage:function(e,t){return console.log(t),new a.a(function(e,s){console.log("POST "+ie+"api/msgs/"),J.a.post(ie+"api/msgs/",K.a.stringify(t),oe.getters.getHeaders).then(function(t){"done"==t.data.message?(oe.dispatch("fetchMsgs",oe.getters.getOpenedChat),e()):s("error")}).catch(function(e){s(e)})})},doLogin:function(){ae.login()},doLogout:function(){console.log("logout"),ae.logout(),oe.dispatch("togglePreLoad",!0)},checkAuth:function(){return console.log("check auth"),new a.a(function(e,t){J.a.get(ie+"api",oe.getters.getHeaders).then(function(s){"api"==s.data.message?oe.dispatch("getUser").then(function(){oe.dispatch("fetchServers").then(function(){e()})}):(console.log("unauth"),t())}).catch(function(){console.log("error"),t()})})}}}),ae=new r.a({el:"#app",router:G,components:{App:B},mounted:function(){},methods:{login:se,logout:ne},template:"<App/>",store:oe});ee.on("connect",function(){console.log("socket connected: "+ee.connected),ee.emit("authenticate",{token:localStorage.getItem("access_token")}).on("authenticated",function(){console.log("auth")}).on("unauthorized",function(e){throw console.log("unauthorized: "+i()(e.data)),new Error(e.data.type)})}),ee.on("disconnect",function(){}),ee.on("reconnect",function(){}),ee.on("reconnect_error",function(){})},"U+iG":function(e,t){},XW58:function(e,t){},hJ0K:function(e,t){},"s6+O":function(e,t){},smEg:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.7c1c64655248cf99601f.js.map